<div class="app-container">
  <mat-toolbar class="navbar">
    <div class="navbar-container">




      <!-- Brand Logo (Left Section) -->
      <a routerLink="/public/home" class="brand-logo">
        <mat-icon class="logo-icon">auto_stories</mat-icon>
        <span class="brand-name">Book Nest</span>
      </a>

      <!-- Mobile Menu Button -->
      <button mat-icon-button class="menu-button" (click)="toggleMobileMenu()">
        <mat-icon>menu</mat-icon>
      </button>

      <!-- Main Navigation -->
      <nav class="main-nav" [class.show-mobile]="showMobileMenu">
        <ng-container *ngFor="let link of navLinks">
          <a [routerLink]="link.path" routerLinkActive="active-link">
            <mat-icon>{{link.icon}}</mat-icon>
            <span>{{link.label}}</span>
          </a>
        </ng-container>
      </nav>

      <!-- Right Section -->
      <div class="right-section">
        <!-- Search -->
        <div class="search-box">
          <mat-icon>search</mat-icon>
          <input type="text" placeholder="Search books...">
        </div>

        <!-- Not Authenticated -->
        <ng-container *ngIf="!isAuthenticated">
          <button mat-icon-button [matMenuTriggerFor]="shoppingCart" class="cart-button">
            <mat-icon [matBadge]="cartItemCount" [matBadgeHidden]="!cartItemCount"
              matBadgeColor="warn">shopping_bag</mat-icon>
          </button>
          <button class="btn btn-outline" [routerLink]="'/auth/login'">Sign in</button>
          <button class="btn btn-primary" [routerLink]="'/auth/register'">Register</button>
        </ng-container>

        <!-- Authenticated User -->
        <ng-container *ngIf="isAuthenticated">
          <button mat-icon-button [matMenuTriggerFor]="shoppingCart" class="cart-button">
            <mat-icon [matBadge]="cartItemCount" [matBadgeHidden]="!cartItemCount"
              matBadgeColor="warn">shopping_bag</mat-icon>
          </button>

          <!-- Admin Menu -->
          <button mat-icon-button [matMenuTriggerFor]="adminMenu" *ngIf="currentUserData?.role === 'ADMIN'">
            <div class="user-avatar">
              <mat-icon>admin_panel_settings</mat-icon>
            </div>
          </button>

          <!-- User Menu -->
          <button mat-icon-button [matMenuTriggerFor]="userMenu" *ngIf="currentUserData?.role === 'USER'">
            <div class="user-avatar">
              <mat-icon>person_outline</mat-icon>
            </div>
          </button>
        </ng-container>
      </div>
    </div>
  </mat-toolbar>

  <!-- Shopping Cart Menu -->
  <mat-menu #shoppingCart="matMenu" class="shopping-card-menu">
    <div class="menu-header">
      <p>Shopping Cart ({{cartItemCount}})</p>
    </div>
    <div class="menu-content">
      <div *ngIf="!cart?.items?.length" class="empty-cart">
        <p>Your cart is empty.</p>
      </div>
      <div *ngIf="cart?.items?.length" class="cart-items">
        <div *ngFor="let item of cart.items" class="cart-item">
          <img [src]="item.productId.imageUrl || '/assets/images/book-default.png'" [alt]="item.productId.title">
          <div class="item-details">
            <span class="item-title">{{item.productId.title}}</span>
            <span class="item-price">{{item.price | currency}}</span>
            <div class="quantity-controls">
              <button mat-icon-button
                (click)="updateQuantity(item.productId._id, item.quantity - 1); $event.stopPropagation()">
                <mat-icon>remove</mat-icon>
              </button>
              <span>{{item.quantity}}</span>
              <button mat-icon-button
                (click)="updateQuantity(item.productId._id, item.quantity + 1); $event.stopPropagation()">
                <mat-icon>add</mat-icon>
              </button>
            </div>
            <button mat-icon-button (click)="removeFromCart(item.productId._id)" class="remove-btn">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
        <div class="cart-total">
          <span>Total:</span>
          <span>{{cart.totalAmount | currency}}</span>
        </div>
      </div>
    </div>
    <div class="menu-footer">
      <button mat-flat-button color="primary" class="checkout-btn" [disabled]="!cart?.items?.length"
        (click)="checkout()">
        Checkout
      </button>
    </div>
  </mat-menu>

  <!-- Admin Menu -->
  <mat-menu #adminMenu="matMenu" class="user-menu">
    <div class="menu-header">
      <p class="user-email" *ngIf="currentUserData">{{currentUserData.email}}</p>
      <p class="user-role">Administrator</p>
    </div>
    <mat-divider></mat-divider>
    <button mat-menu-item routerLink="/books">
      <mat-icon>library_books</mat-icon>
      <span>Products</span>
    </button>
    <button mat-menu-item routerLink="/customers/list">
      <mat-icon>groups</mat-icon>
      <span>Customers</span>
    </button>
    <button mat-menu-item routerLink="/orders/all">
      <mat-icon>receipt_long</mat-icon>
      <span>Orders</span>
    </button>
    <button mat-menu-item routerLink="/users">
      <mat-icon>manage_accounts</mat-icon>
      <span>Users</span>
    </button>
    <mat-divider></mat-divider>
    <button mat-menu-item (click)="onLogout()" class="logout-item">
      <mat-icon>logout</mat-icon>
      <span>Sign out</span>
    </button>
  </mat-menu>

  <!-- User Menu -->
  <mat-menu #userMenu="matMenu" class="user-menu">
    <div class="menu-header" *ngIf="currentUserData">
      <p class="user-name">{{currentUserData.firstName}} {{currentUserData.lastName}}</p>
      <p class="user-email">{{currentUserData.email}}</p>
    </div>
    <mat-divider></mat-divider>
    <button mat-menu-item routerLink="/user/profile">
      <mat-icon>person_outline</mat-icon>
      <span>Profile</span>
    </button>
    <button mat-menu-item routerLink="/orders/myOrders">
      <mat-icon>library_books</mat-icon>
      <span>My Orders</span>
    </button>
    <mat-divider></mat-divider>
    <button mat-menu-item (click)="onLogout()" class="logout-item">
      <mat-icon>logout</mat-icon>
      <span>Sign out</span>
    </button>
  </mat-menu>




  <app-spinner></app-spinner>
  <router-outlet></router-outlet>
</div>

<app-footer></app-footer>